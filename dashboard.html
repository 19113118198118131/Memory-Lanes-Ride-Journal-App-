<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ride Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>My Ride Journal</h1>
    <button id="logout-btn">Logout</button>
  </header>

  <main>
    <h2>Your Rides</h2>
    <div id="ride-list">Loading...</div>
  </main>

  <!-- Use only the module-based Supabase import -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    const SUPABASE_URL = 'https://vodujxiwkpxaxaqnwkdd.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvZHVqeGl3a3B4YXhhcW53a2RkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY3NTgwOTQsImV4cCI6MjA2MjMzNDA5NH0.k4NeZ3dgqe1QQeXmkmgThp-X_PwOHPHLAQErg3hrPok';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const rideList = document.getElementById('ride-list');
    const logoutBtn = document.getElementById('logout-btn');

    const { data: { user }, error } = await supabase.auth.getUser();
    if (!user) {
      window.location.href = 'index.html';
    }

    const { data: rides, error: fetchError } = await supabase
      .from('ride_logs')
      .select('*')
      .eq('user_id', user.id)
      .order('created_at', { ascending: false });

    rideList.innerHTML = '';

    if (fetchError) {
      rideList.textContent = '❌ Failed to load rides.';
    } else if (!rides.length) {
      rideList.textContent = 'No rides found.';
    } else {
      rides.forEach(ride => {
        const item = document.createElement('div');
        item.className = 'ride-entry';
        item.innerHTML = `
          <strong>${ride.title}</strong><br/>
          📍 ${ride.distance_km.toFixed(1)} km – ⏱ ${ride.duration_min} min – ⛰️ ${ride.elevation_m} m
        `;
        item.addEventListener('click', () => {
          console.log('Ride clicked:', ride.id);
          localStorage.setItem('selectedRideId', ride.id);
          window.location.href = 'index.html';
        });
      
        rideList.appendChild(item);
      });
    }

    logoutBtn.addEventListener('click', async () => {
      await supabase.auth.signOut();
      window.location.href = 'index.html';
    });
  </script>
</body>
</html>
